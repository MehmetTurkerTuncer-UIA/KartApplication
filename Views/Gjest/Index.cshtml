@model KartApplication.Models.AreaChange
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_GjestLayout.cshtml";
}

<br>
<center><h2>Velg Sted</h2></center>

<!-- Harita konteyneri -->
<div id="map" style="height: 400px; width: 100%; position: relative;">
    <!-- Arama kutusunu haritanın içinde yapacak kapsayıcı -->
    <div id="search-container" style="position: absolute; top: 10px; right: 0; margin-right:10px; z-index: 1000; width: 400px;">
        <div class="input-group">
            <input type="text" id="searchInput" name="address" class="form-control" placeholder="Enter full address" aria-label="Search Address" autocomplete="off" />
            <div class="input-group-append">
                <button type="button" class="btn-primary" id="searchAddressBtn">
                    <i class="bi bi-search black-icon"></i> <!-- Bootstrap büyüteç ikonu -->
                </button>
            </div>
        </div>
        <!-- Öneriler için dropdown menü -->
        <div id="suggestions" class="suggestions-dropdown" style="display: none;">
            <!-- Öneriler buraya eklenecek -->
        </div>
    </div>
</div>
<br />

<!-- Koordinatları tablo halinde göstermek için -->
<h3>Valgte Koordinater:</h3>
<table class="table table-bordered" id="coordinatesTable">
    <thead>
        <tr>
            <th>#</th>
           <th>Breddegrad</th>
            <th>Lengdegrad</th>
        </tr>
    </thead>
    <tbody id="coordinatesTableBody">
        <!-- Koordinatlar buraya eklenecek -->
    </tbody>
</table>

<!-- Form -->
<form asp-controller="Gjest" asp-action="Index" method="post" onsubmit="return validateForm()">
    <input type="hidden" id="geoJsonInput" name="geoJson" /> <!-- GeoJSON verisini saklamak için gizli alan -->
    <input type="hidden" id="addressInput" name="address" /> <!-- Adres verisini saklamak için gizli alan -->
    <input type="hidden" id="selectedMapType" name="selectedMapType" value="fargekart" /> <!-- Seçilen harita tipini saklamak için gizli alan -->
    <br />
        <button type="submit" class="btn btn-primary" style="background-color: #006aff; color: white; padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer;">Neste</button>
</form>

@section Scripts {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />

    <style>
        /* Dropdown öneri menüsü stili */
        .suggestions-dropdown {
            position: absolute;
            background-color: white;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            width: 100%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 0;
            margin-top: 5px;
            border-radius: 5px;
        }

        /* Harita kutuları stili */
        .map-thumbnails {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .map-thumbnail {
            width: 60px;
            height: 60px;
            border: 3px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .map-thumbnail.selected {
            border-color: orange;
        }

        /* Görsellerin küçük olmasını sağla */
        .map-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            color: black;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        .suggestion-title {
            font-weight: bold;
            font-size: 14px;
        }

        .suggestion-address {
            font-size: 12px;
            color: black;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>

     <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

<script>
        // Haritayı başlat
        var map = L.map('map').setView([58.1467, 7.9956], 15); // Kristiansand, UiA konumu

        // Kartverket Fargekart (Renkli Harita)
        var fargekart = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topo/default/webmercator/{z}/{y}/{x}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="https://kartverket.no/">Kartverket</a>'
        }).addTo(map); // Başlangıçta Fargekart yüklü

        // Kartverket Gråtonekart (Gri Tonlamalı Harita)
        var gratonekart = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topograatone/default/webmercator/{z}/{y}/{x}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="https://kartverket.no/">Kartverket</a>'
        });

         // Kartverket Turkart (Yürüyüş Haritası)
        var turkart = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/toporaster/default/webmercator/{z}/{y}/{x}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="https://kartverket.no/">Kartverket</a>'
        });

        // Kartverket Sjøkart (Deniz Haritası)
        var sjokart = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/sjokartraster/default/webmercator/{z}/{y}/{x}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="https://kartverket.no/">Kartverket</a>'
        });

        // Başlangıç haritası olarak Fargekart'ı ekle
        var currentLayer = fargekart;
        var selectedMapType = 'fargekart'; // Varsayılan harita tipi

        // Sağ altta küçük kareler şeklinde harita seçenekleri ekle
        var thumbnailsContainer = document.createElement('div');
        thumbnailsContainer.classList.add('map-thumbnails');
        document.getElementById('map').appendChild(thumbnailsContainer);

        // Harita küçük resimlerini ekle
        var maps = [
            { id: 'fargekart', layer: fargekart, imageUrl: '@Url.Content("~/images/4.png")', title: 'Fargekart' },
            { id: 'gratonekart', layer: gratonekart, imageUrl: '@Url.Content("~/images/3.png")', title: 'Gråtonekart' },
            { id: 'turkart', layer: turkart, imageUrl: '@Url.Content("~/images/2.png")', title: 'Turkart' },
            { id: 'sjokart', layer: sjokart, imageUrl: '@Url.Content("~/images/1.png")', title: 'Sjøkart' }
        ];

        maps.forEach(function(mapInfo, index) {
            var thumbnailDiv = document.createElement('div');
            thumbnailDiv.classList.add('map-thumbnail');
            if (index === 0) {
                thumbnailDiv.classList.add('selected');
            }

            var img = document.createElement('img');
            img.src = mapInfo.imageUrl;
            img.alt = mapInfo.title;
            img.title = mapInfo.title; // Fare üzerine gelince harita adını göstermek için title kullanıyoruz
            thumbnailDiv.appendChild(img);
            thumbnailsContainer.appendChild(thumbnailDiv);
